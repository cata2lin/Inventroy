/* ==========================================================================
   Inventory Intelligence — UI System (Compact + Unified Filters) — FINAL
   ==========================================================================
   - Explicit light/dark tokens via [data-theme] + prefers-color-scheme fallback
   - One source of truth for filter/pill sizing (height, radius, font, padding)
   - Consistent buttons (no "tile" explosions), compact pagination
   - Accessible focus rings, reduced motion support, high-contrast tweaks
   - All original hooks kept (#ids, .classes) so your JS keeps working
/* ======================================================================= */

/* ----- Baseline reset & a11y helpers ---------------------------------- */
*, *::before, *::after { box-sizing: border-box; }
html, body { height: 100%; }
:where(img, svg, video, canvas) { max-width: 100%; height: auto; }
:where(button, input, select, textarea) { font: inherit; color: inherit; }
:where(a) { color: inherit; text-decoration: none; }
:where([hidden]) { display: none !important; }
:root { color-scheme: light dark; }

/* Visible focus only when keyboarding */
:focus { outline: none; }
:focus-visible {
  outline: 2px solid color-mix(in oklab, var(--accent), #fff 8%);
  outline-offset: 2px;
}

/* Accessible skip link */
.skip-link {
  position: absolute; left: -9999px; top: -9999px;
}
.skip-link:focus-visible {
  left: var(--s-4); top: var(--s-4);
  background: var(--accent); color: var(--accent-contrast);
  padding: var(--s-2) var(--s-3); border-radius: var(--radius-sm); z-index: 9999;
}

/* ----- Design tokens --------------------------------------------------- */
:root {
  /* Palette (semantic) */
  --bg: #0b0d10;
  --surface: #101419;
  --surface-2: #121821;
  --text: #e6e8eb;
  --muted: #aab3bd;
  --border: #243042;
  --accent: #4ea1ff;
  --accent-contrast: #06131f;

  /* Status palette */
  --c-green: #2e7d32;
  --c-amber: #ef6c00;
  --c-red: #c62828;
  --c-grey: #607d8b;
  --c-blue: #0d6efd;
  --c-violet: #7e57c2;

  /* Typography */
  --font-sans: Inter, ui-sans-serif, system-ui, "Segoe UI", Roboto, Helvetica, Arial,
               "Apple Color Emoji", "Segoe UI Emoji";
  --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --font-size: 14px;
  --line: 1.5;

  /* Layout / radius / shadow */
  --radius: 12px;
  --radius-sm: 8px;
  --shadow-sm: 0 1px 2px rgba(0,0,0,.15);
  --shadow-md: 0 6px 20px rgba(0,0,0,.18);

  /* Spacing */
  --s-1: 4px;
  --s-2: 8px;
  --s-3: 12px;
  --s-4: 16px;
  --s-5: 24px;
  --s-6: 32px;
  --s-7: 40px;

  /* Filter/controls (single source of truth) */
  --filter-h: 34px;
  --filter-radius: 12px;
  --filter-font: 0.68rem;
  --filter-pad-x: 12px;
  --filter-bg: var(--surface);
  --filter-bd: var(--border);
  --filter-focus: 0 0 0 2px color-mix(in oklab, var(--accent), transparent 75%);

  /* Bulk Update density */
  --bu-thumb: 36px;
  --bu-input-font: 0.66em;
  --bu-input-h: 22px;

  /* Pagination */
  --pg-h: 26px;
  --pg-font: 0.60rem;
  --pg-pad-x: 10px;
}

/* Optional explicit theme switch via [data-theme] */
/* Dark (default) is already set in :root */
:root[data-theme="light"] {
  --bg: #f6f8fa;
  --surface: #ffffff;
  --surface-2: #f2f4f7;
  --text: #0b0d10;
  --muted: #5b6b7d;
  --border: #d9e0e8;
  --accent: #0d6efd;
  --accent-contrast: #ffffff;
}

/* Respect user preference if no explicit [data-theme] set */
@media (prefers-color-scheme: light) {
  :root:not([data-theme="dark"]) {
    --bg: #f6f8fa;
    --surface: #ffffff;
    --surface-2: #f2f4f7;
    --text: #0b0d10;
    --muted: #5b6b7d;
    --border: #d9e0e8;
    --accent: #0d6efd;
    --accent-contrast: #ffffff;
  }
}

/* High contrast / reduced motion */
@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
}
@media (prefers-contrast: more) {
  :root { --border: color-mix(in oklab, var(--text), #000 15%); }
}

/* ----- Base ------------------------------------------------------------ */
body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-sans);
  font-size: var(--font-size);
  line-height: var(--line);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ----- Layout ---------------------------------------------------------- */
.app-layout {
  display: grid;
  grid-template-columns: 260px 1fr;
  min-height: 100vh;
}
.sidebar {
  background: var(--surface-2);
  border-right: 1px solid var(--border);
  padding: var(--s-5) var(--s-4);
  position: sticky; top: 0; align-self: start; height: 100vh; overflow: auto;
}
.sidebar .brand { font-weight: 700; margin-bottom: var(--s-5); }
.sidebar nav ul { list-style: none; padding: 0; margin: 0; display: grid; gap: 6px; }
.sidebar nav a {
  display: block; padding: 10px 12px; border-radius: 10px; color: var(--text); border: 1px solid transparent;
}
.sidebar nav a:hover { background: var(--surface); border-color: var(--border); }
.sidebar nav a.active { background: var(--accent); color: var(--accent-contrast); border-color: transparent; }

.main-content { padding: var(--s-6); display: grid; gap: var(--s-6); }

.container { max-width: 1080px; margin: 0 auto; }
.container-fluid { width: 100%; }

.page-header h1 { margin-bottom: 2px; }
.page-header h2 { color: var(--muted); font-weight: 500; }

/* ----- Cards & grids --------------------------------------------------- */
.card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); padding: var(--s-5); box-shadow: var(--shadow-sm);
}
.card header { margin-bottom: var(--s-3); }
.cards-grid { display: grid; gap: var(--s-5); grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }

.metrics-grid { display: grid; gap: var(--s-4); grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); }
.metric {
  background: var(--surface); border: 1px dashed var(--border);
  border-radius: var(--radius-sm); padding: var(--s-3);
}
.metric strong { font-size: 13px; color: var(--muted); }
.metric .value { font-size: 18px; font-weight: 700; }

/* ----- Controls (Unified filter style) -------------------------------- */
.controls-grid {
  display: grid; gap: var(--s-3);
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  align-items: center; /* baseline consistent */
  font-size: var(--filter-font);
  row-gap: 0.5rem;
}

/* Base chip/select look */
.controls-grid input[type="search"],
.controls-grid input[type="text"],
.controls-grid input[type="number"],
.controls-grid input[type="date"],
.controls-grid select,
.controls-grid .dropdown > summary {
  height: var(--filter-h); min-height: var(--filter-h);
  border-radius: var(--filter-radius);
  padding: 0 var(--filter-pad-x);
  font-size: var(--filter-font); line-height: 1.1;
  background: var(--filter-bg); border: 1px solid var(--filter-bd);
}

/* Show magnifier + prevent overlap where used */
.controls-grid .control { position: relative; display: block; }
.controls-grid .control .icon {
  position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
  pointer-events: none; width: 16px; height: 16px;
}
.controls-grid .control input[type="search"] {
  padding-left: calc(var(--filter-pad-x) + 18px) !important;
}

/* Dropdown panel */
.dropdown[open] > summary {
  border-color: color-mix(in oklab, var(--accent), var(--filter-bd) 60%);
  box-shadow: var(--filter-focus);
}
.dropdown[open] > ul {
  position: absolute; z-index: 1000; top: 100%; left: 0; margin-top: 0.25rem; padding: 0.6rem;
  background: var(--surface) !important; border: 1px solid var(--border);
  border-radius: var(--radius); box-shadow: var(--shadow-md);
  width: max-content; min-width: 200px; max-height: 300px; overflow-y: auto;
  font-size: var(--filter-font);
}
.dropdown li label { padding: 0.2rem; display: block; }
.dropdown input[type="radio"], .dropdown input[type="checkbox"] { margin-right: 0.5em; }

/* Numeric inputs neutral spin buttons */
input[type="number"] { -moz-appearance: textfield; }
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

/* Datepicker polish */
.controls-grid input[type="date"] { appearance: none; -webkit-appearance: none; }
.controls-grid input[type="date"]::-webkit-calendar-picker-indicator { opacity: .85; }

/* Columns button styled as a chip */
#column-visibility-button {
  height: var(--filter-h); font-size: var(--filter-font);
  border-radius: var(--filter-radius); padding: 0 var(--filter-pad-x);
  background: var(--filter-bg); border: 1px solid var(--filter-bd); color: inherit;
}
#column-visibility-button .icon { width: 16px; height: 16px; }

/* Dashboard v2 scope: keep search icon hidden + padding corrected */
section.controls-grid:has(#financial-status-filter) .control .icon { display: none !important; }
section.controls-grid:has(#financial-status-filter) .control input[type="search"] {
  padding-left: var(--filter-pad-x) !important;
}

/* ----- Buttons --------------------------------------------------------- */
button { gap: 8px; display: inline-flex; align-items: center; justify-content: center; }
button.secondary.outline { border-style: dashed; }
#export-button, #reset-filters,
#save-changes-btn,
#sync-all-orders-btn, #sync-all-products-btn, #sync-single-store-btn, #sync-date-range-btn,
#import-excel-btn {
  display: inline-flex !important; align-items: center; gap: .5rem;
  height: var(--filter-h) !important; padding: 0 var(--filter-pad-x) !important;
  font-size: var(--filter-font) !important; border-radius: var(--filter-radius) !important;
  max-width: max-content;
}
#export-button .icon,
#sync-all-orders-btn .icon, #sync-all-products-btn .icon, #sync-single-store-btn .icon, #sync-date-range-btn .icon {
  width: 16px; height: 16px;
}

/* File input + Import aligned and same height */
.import-controls {
  display: grid; grid-template-columns: minmax(300px, max-content) auto;
  gap: 0.75rem; align-items: center; justify-content: start;
}
.import-controls input[type="file"] { font-size: var(--filter-font); width: auto; max-width: 100%; white-space: nowrap; }
.import-controls input[type="file"]::file-selector-button {
  height: var(--filter-h); padding: 0 var(--filter-pad-x);
  font-size: var(--filter-font); border-radius: var(--filter-radius);
  background: var(--filter-bg); border: 1px solid var(--filter-bd);
}
#import-excel-btn { white-space: nowrap; }

/* ----- Toggle pill (for inventory group-by) ---------------------------- */
.toggle-pill { display: inline-flex; align-items: center; gap: 8px; width: fit-content; }
.toggle-pill input[type="checkbox"] { position: absolute; opacity: 0; width: 1px; height: 1px; }
.toggle-pill .slider {
  position: relative; width: 44px; height: 24px; border-radius: 999px;
  background: var(--border); transition: background .2s ease;
}
.toggle-pill .slider .knob {
  position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; border-radius: 50%;
  background: var(--surface); box-shadow: 0 1px 3px rgba(0,0,0,.2); transition: transform .2s ease;
}
.toggle-pill .slider.on { background: var(--accent); }
.toggle-pill .slider.on .knob { transform: translateX(20px); }

/* ----- Tables ---------------------------------------------------------- */
.table-wrap {
  overflow: auto; border-radius: var(--radius); border: 1px solid var(--border); background: var(--surface);
}
table { width: 100%; border-collapse: collapse; font-size: 13px; }
thead th {
  position: sticky; top: 0;
  background: color-mix(in oklab, var(--surface), #000 4%);
  border-bottom: 1px solid var(--border); z-index: 2;
}
th, td { padding: 6px 8px; border-bottom: 1px solid var(--border); vertical-align: middle; }
tbody tr:hover { background: color-mix(in oklab, var(--surface), #000 3%); }
tbody tr:nth-child(even) { background: color-mix(in oklab, var(--surface), #000 2%); }
td code, td .code { font-family: var(--font-mono); font-size: 12px; }
.number, td.num, th.num { text-align: right; font-variant-numeric: tabular-nums; }
.sticky-col { position: sticky; left: 0; z-index: 1; background: inherit; }

/* Sorting chevrons */
th[data-sort-by] {
  position: relative; padding-right: 1.5em !important; white-space: nowrap; cursor: pointer;
}
th[data-sort-by].asc::after, th[data-sort-by].desc::after {
  position: absolute; right: 0.5em; top: 50%; transform: translateY(-50%);
  font-size: 0.8em; color: var(--accent);
}
th[data-sort-by].asc::after { content: '▲'; }
th[data-sort-by].desc::after { content: '▼'; }

/* Pagination (Inventory + Orders) */
#orders-table-container + .pagination-controls button,
#inventory-table-container + .pagination-controls button {
  height: var(--pg-h); min-height: var(--pg-h);
  padding: 0 var(--pg-pad-x); font-size: var(--pg-font); border-radius: 10px;
}
#orders-table-container + .pagination-controls #page-indicator,
#inventory-table-container + .pagination-controls #page-indicator {
  font-size: calc(var(--pg-font) + 0.05rem);
}
.pagination-controls { align-items: center; grid-template-columns: 1fr auto 1fr; display: grid; }
.pagination-controls > :first-child { justify-self: start; }
.pagination-controls > :last-child  { justify-self: end; }
#page-indicator { justify-self: center; }

/* ----- Dialog ---------------------------------------------------------- */
dialog::backdrop { background: rgba(0,0,0,.55); }
dialog article {
  background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
}
button.close { --pico-icon-close: none; }
button.close::after {
  content: "✕"; display: inline-flex; align-items: center; justify-content: center;
  width: 28px; height: 28px; border-radius: 50%; border: 1px solid var(--border);
}

/* ----- Toast ----------------------------------------------------------- */
#toast {
  position: fixed; bottom: 20px; right: 20px; z-index: 50;
  background: var(--surface); color: var(--text);
  border: 1px solid var(--border); border-radius: var(--radius);
  padding: 10px 12px; box-shadow: var(--shadow-md); display: none;
}

/* ----- Charts & progress ---------------------------------------------- */
.chart-wrap { width: 100%; overflow: hidden; }
.progress-area .bar { height: 8px; background: var(--border); border-radius: 999px; overflow: hidden; }
.progress-area .bar > span { display: block; height: 100%; background: var(--accent); }

/* ----- Bulk Update (tighter + aligned) -------------------------------- */
.bulk-update-controls .controls-grid { align-items: end; }
#save-changes-btn { /* already normalized in Buttons block */ }

.bulk-update-table { table-layout: fixed; width: 100%; }
.bulk-update-table th, .bulk-update-table td {
  height: 26px; max-height: 26px; padding: 0.06rem 0.32rem; vertical-align: middle;
}
.bulk-update-table th { font-size: 0.72em; }
.bulk-update-table img {
  width: var(--bu-thumb); height: var(--bu-thumb); object-fit: cover; border-radius: var(--radius);
}
.bulk-update-table input[type="text"],
.bulk-update-table input[type="number"],
.bulk-update-table select {
  width: 100%; height: var(--bu-input-h);
  border: 1px solid transparent; background: transparent;
  padding: 0 0.25rem; font-size: calc(var(--bu-input-font) * 1.1); box-sizing: border-box;
}
.bulk-update-table input:focus, .bulk-update-table select:focus {
  border-color: var(--accent);
  background: color-mix(in oklab, var(--surface), #fff 4%);
}
.bulk-update-table input.changed, .bulk-update-table select.changed {
  background-color: color-mix(in oklab, #ffcc00, transparent 90%);
  font-weight: bold;
}
#bulk-apply-row input { font-size: 0.85em; font-style: italic; }

/* ----- Inventory numeric filters (share unified spec) ----------------- */
#min-retail-input, #max-retail-input, #min-inv-input, #max-inv-input {
  height: var(--filter-h); min-height: var(--filter-h);
  border-radius: var(--filter-radius);
  padding: 0 var(--filter-pad-x); font-size: var(--filter-font);
  background: var(--filter-bg); border: 1px solid var(--filter-bd);
}

/* ----- Utilities ------------------------------------------------------- */
.overflow-auto { overflow: auto; }
.inline { display: inline-flex; gap: 8px; align-items: center; }
.hint { cursor: help; font-weight: 700; padding-left: 6px; }
.controls-grid > * { width: 100%; max-width: 100%; }
.controls-grid button { width: max-content; }

/* ----- Responsive ------------------------------------------------------ */
@media (max-width: 1024px) {
  .app-layout { grid-template-columns: 1fr; }
  .sidebar { position: static; height: auto; border-right: none; border-bottom: 1px solid var(--border); }
  .sidebar nav ul { grid-auto-flow: column; grid-auto-columns: max-content; overflow: auto; }
  .main-content { padding: var(--s-5); }
}
@media (max-width: 640px) {
  .container, .container-fluid { padding: 0; }
  .controls-grid { grid-template-columns: 1fr 1fr; }
  .cards-grid { grid-template-columns: 1fr; }
}

/* ----- Status colors & badge ------------------------------------------ */
/* Financial */
.status-paid { color: var(--c-green); }
.status-authorized, .status-pending, .status-partially_paid { color: var(--c-amber); }
.status-refunded, .status-partially_refunded { color: var(--c-red); }
.status-voided { color: var(--c-grey); }
/* Fulfillment */
.status-fulfilled, .status-shipped { color: var(--c-green); }
.status-partially_fulfilled, .status-in_progress, .status-scheduled { color: var(--c-amber); }
.status-unfulfilled, .status-returned { color: var(--c-red); }
.status-restocked { color: var(--c-violet); }
.status-on_hold { color: var(--c-blue); }
.status-cancelled, .status-archived { color: var(--c-grey); }

/* Optional pill badge */
.status-badge {
  display: inline-block; padding: 0.12rem 0.45rem; border-radius: 999px; border: 1px solid currentColor;
  font-size: 0.68rem; font-weight: 600; letter-spacing: .01em;
  background: color-mix(in oklab, currentColor, transparent 90%);
}
